<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=1024, user-scalable=no">

	<title>Liferay and OSGi: A practical approach</title>
	
	<!-- Required stylesheet -->
	<link rel="stylesheet" href="core/deck.core.css">
	
	 <!-- fonts -->
    <link rel='stylesheet' href='http://fonts.googleapis.com/css?family=PT+Sans:400,700,400italic,700italic|PT+Sans+Narrow:400,700|Ubuntu+Mono:400,700' type='text/css'>

	<link rel="stylesheet" href="extensions/goto/deck.goto.css">
	<link rel="stylesheet" href="extensions/menu/deck.menu.css">
	<link rel="stylesheet" href="extensions/navigation/deck.navigation.css">
	<link rel="stylesheet" href="extensions/status/deck.status.css">
	<link rel="stylesheet" href="extensions/hash/deck.hash.css">
	<link rel="stylesheet" href="extensions/scale/deck.scale.css">

	<!-- Style theme. More available in /themes/style/ or create your own. -->
	<link rel="stylesheet" href="themes/style/web-2.0.css">
	
	<link rel="stylesheet" id="transition-theme-link" href="themes/transition/fade.css">   
    <link rel="stylesheet" id="style-theme-link" href="liferay.css">
	
	<script src="jquery-1.7.2.min.js"></script>
    <script src="modernizr.custom.js"></script>
    <script src="core/deck.core.js"></script>
    <script src="extensions/hash/deck.hash.js"></script>
    <script src="extensions/menu/deck.menu.js"></script>
    <script src="extensions/goto/deck.goto.js"></script>
    <script src="extensions/status/deck.status.js"></script>

    <link rel="stylesheet" href="solarized_light.css">
    <script src="highlight.pack.js"></script>

   <script>
    $(document).ready(function() {
            $.deck('.slide');
            $('pre').each(function(i, e) {
                    hljs.highlightBlock(e, '  ');
            });
            $('code').each(function(i, e) {
                    hljs.highlightBlock(e);
            });
    });
    </script>
</head>

<body class="deck-container">

<p class="deck-status">slide <span class="deck-status-current"></span> / <span class="deck-status-total"></span></p>

<section class="slide" style="font-size: 100%">
   <h1>
    <div>Liferay and OSGi</div>
    <div style="font-size: 38%">A practical approach</div>
    <br/>
    <div style="font-size: 50%">Miguel √Ångel Pastor Olivar</div>
    <div style="font-size: 50%">miguel.pastor@liferay.com</div>
    <div style="font-size: 50%">Twitter handler: <a href="http://twitter.com/miguelinlas3">miguelinlas3</a></div>
    <div style="font-size: 50%"><br/></div>
   </h1>
</section>

<section class="slide" style="margin-left:11%">
	<h2>A little bit about me</h2>
	<ul>
		<div class="slide">
			<li>Liferay platform infrastructure lead</li>
		</div>			
		<div class="slide">
			<li>Cloud computing and distributed systems</li>
		</div>		
		<div class="slide">
			<li>Interests in concurrent and distributed programming. Functional programming advocate!
		</div>
		<div class="slide">
			<li>PHD student? (on standby for a while)</li>
		</div>		
		<div class="slide">
			<li>Twitter handler: <a href="http://twitter.com/miguelinlas3">miguelinlas3</a></li>
		</div>
		<div class="slide">
			<li>Email address: miguelinlas3@gmail.com</li>
		</div>		
	</ul>
</section>

<section class="slide">
	<h1>What will we talking about on this lesson?</h1>
</section>

<section class="slide" style="margin-left:11%">
	<h2>Agenda</h2>
	<ul>
		<div class="slide">
			<li>Overview of the general architecture</li>
		</div>
		<div class="slide">
			<li>Building an application</li>
			<div class="slide">	
				<ul>			
					<div class="slide">	
						<li>Modular</li>
					</div>
					<div class="slide">	
						<li>Configurable</li>
					</div>
					<div class="slide">	
						<li>Extensible</li>
					</div>
					<div class="slide">	
						<li>Reusable</li>
					</div>
					<div class="slide">	
						<li>Testable</li>
					</div>
					<div class="slide">	
						<li>Easy to package and deploy</li>
					</div>
				<ul>
			</div>
		</div>
		<div class="slide">
			<li>Extending the portal</li>
		</div>
		<div class="slide">
			<li>Questions and answers</li>
		</div>
	</ul>
</section>

<section class="slide">
	<h1>
		OSGi intro
		<div style="font-size: 50%">A bit of history</div>
	</h1>
</section>

<section class="slide" >
	<div class="slide" style="margin-left:11%">
		<h2>OSGi history</h2>
		<div class="slide">
			<h3>Born in 1999</h3>
			<ul>
				<div class="slide">
					<li><p>Embedded world</p></li>
				</div>
				<div class="slide">
					<li><p>Popular because of its complexity?</p></li>
				</div>
				<div class="slide">
					<li><p></p></li>
				</div>
			</ul>				
		</div>	
	</div>	
</section>

<section class="slide" >
	<div class="slide" style="margin-left:11%">
		<h2>Cloud foundations</h2>				
			<div class="slide">
				<h3>Virtualization</h3>
				<ul>
					<div class="slide">
						<li><p>Nothing new: 5-10 years</p></li>
					</div>
					<div class="slide">
						<li><p>Mainstay: Millions of servers</p></li>
					</div>
					<div class="slide">
						<li><p><italic>Commodity hardware</italic> usage</p></li>
					</div>
				</ul>	
			</div>
			<div class="slide">
				<h3>Elasticity</h3>
				<ul>
					<div class="slide">
						<li><p>Dynamic scaling</p></li>
					</div>
					<div class="slide">
						<li><p>Resources usage is regulated</p></li>
					</div>
					<div class="slide">
						<li><p>Traditionally over-provisioning is done. Slow and costly</p></li>
					</div>
				</ul>	
			</div>
			<div class="slide">
				<h3>Automatic provisioning</h3>								
				<ul>
					<div class="slide">
						<li><p>All operations are done via API</p></li>
					</div>
					<div class="slide">
						<li><p>Dymically: based on the requirements</p></li>
					</div>
					<div class="slide">
						<li><p>Handling unexpected conditions</p></li>
					</div>
					<div class="slide">
						<li><p>Pay for use!</p></li>
					</div>
				</ul>			
			</div>
			<div class="slide">
				<h3>Measurement and paying</h3>
				<ul>
					<div class="slide">
						<li><p>Pay for use!</p></li>
					</div>
					<div class="slide">
						<li><p>Balanced competition!</p></li>
					</div>

				</ul>	
			</div>		
	</div>
</section>

<section class="slide">
	<h1>Do I really need the Cloud??</h1>
</section>

<section class="slide" style="margin-left:11%">
	<h2>Myth or reallity?</h2>
	<div class="slide"><h3>Trending topic</h3></div>
	<div class="slide"><h3>Our CIO says we need to be there</h3></div>
	<div class="slide"><h3>Faster time to market</h3></div>
	<div class="slide"><h3>Access to pooled resources</h3></div>
	<div class="slide"><h3>Hybrid IT</h3></div>
</section>

<section class="slide">
	<h1>Cloud models</h1>
</section>

<section class="slide">
	<h1>Infrastructure as a Service</h1>
</section>

<section class="slide" style="margin-left:11%">
	<h2>Infrastructure as a Service</h2>
	<div class="slide"><h3>Lowest level of abstraction</h3></div>
	<div class="slide">
		<h3>Everything is exposed as a service</h3>
		<ul>
			<div class="slide">
				<li><p>Virtual machines</p></li>
			</div>
			<div class="slide">
				<li><p>Load Balancers</p></li>
			</div>
			<div class="slide">
				<li><p>Firewalls</p></li>
			</div>
			<div class="slide">
				<li><p>Storage systems (databases, . . .)</p></li>
			</div>
		</ul>	
	</div>
	<div class="slide">
		<h2>Platform as a Service</h2>
	</div>

	<div class="slide"><h3>Higher level of abstraction</h3></div>
	<div class="slide">
		<h3>Applications and services. Forget everything about</h3>
		<ul>
			<div class="slide">
				<li><p>Virtual machines, CPUs, ...</p></li>
			</div>
			<div class="slide">
				<li><p>Storage</p></li>
			</div>
			<div class="slide">
				<li><p>IP Management</p></li>
			</div>
		</ul>	
	</div>
	<div class="slide"><h3>Common problem: Vendor Lock-in</h3></div>

	<div class="slide">
		<h2>Software as a Service</h2>
	</div>

	<div class="slide"><h3>Applications and services</h3></div>
	<div class="slide"><h3>Demand usage</h3></div>
	<div class="slide"><h3>Examples: GMail, Salesforce, ...</h3></div>

</section>

<section class="slide">
	<h1>Going deeper into PaaS</h1>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>PaaS definition</h2>	
		<blockquote cite="">  		
			Platform as a service (PaaS) is a category of cloud computing services that provide a computing platform and a solution stack as a service
			<p><cite><a href="http://en.wikipedia.org/wiki/Platform_as_a_service">Wikipedia</a></cite></p>
		</blockquote>
		<div class="slide"><h2>Open PaaS</h2></div>
		<div class="slide"><h3>Support for different languages and frameworks</h3></div>		
		<div class="slide"><h3>Great choice of many application services: databases, messaging queues, cache solutions ...</h3></div>
		<div class="slide"><h3>Portability</h3></div>	
		<div class="slide"><h3>Extensible</h3></div>	
		<div class="slide"><h3>Agile development</h3></div>	
		<div class="slide"><h3>Automated application infrastructure</h3></div>
		<div class="slide"><h3>Self service app deployment</h3></div>
		<div class="slide"><h3>Cloud provider deployment freedom</h3></div>		
	</div>
</section>

<section class="slide">
	<h1>Building our application</h1>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Tools</h2>	
		<div class="slide"><h3><a href="http://cloudfoundry.org">Cloud Foundry</a></h3></div>
		<div class="slide"><h3><a href="http://playframework.com">Play Framework</a></h3></div>		
		<div class="slide"><h3><a href="http://docs.cloudfoundry.com/tools/vmc/installing-vmc.html">CLI for Cloud Foundry</a></h3></div>
	</div>
	<div class="slide" style="margin-left:11%">
		<h2>What are we going to do?</h2>		
		<div class="slide"><h3>CloudFoundry overview</h3></div>
		<div class="slide"><h3>Install our local CloudFoundry environment</h3></div>		
		<div class="slide"><h3>Develop our application</h3></div>
		<div class="slide"><h3>Testing our development in a local environment</h3></div>
		<div class="slide"><h3>Deploying our application to a production environment</h3></div>
	</div>	
</section>

<section class="slide">	
	<h1>Cloud Foundry overview</h1>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Open architecture</h2>
		<div class="slide"><p>Choice of clouds for deployment</p></div>
		<div class="slide"><p>Choice of industry-standard frameworks and application infrastructure services</p></div>
		<div class="slide"><p>Extensible architecture to ‚Äúdigest‚Äù future cloud innovation</p></div>
		<div class="slide"><p>Available as open source</p></div>
	</div>
	<div class="slide" style="margin-left:11%">
		<h2>Self-service application execution engine</h2>
		<div class="slide"><p>Build applications with latest high productivity frameworks</p></div>
	</div>
	<div class="slide" style="margin-left:11%">
		<h2>Automation engine for deployment and lifecycle management</h2>
		<div class="slide"><p>Deploy and cloud-scale applications in seconds</p></div>
	</div>
</section>
<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Alternatives</h2>
		<div class="slide"><p><img src="images/CloudFoundry.png" /></p></div>		
	</div>
</section>

<section class="slide">
	<h1>
		Installing our Cloud Foundry local environment
		<div style="font-size: 38%">We are not going to cover this</div>
	</h1>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Requirements</h2>
		<div class="slide"><p><a href="http://www.vagrantup.com/">Vagrant</a></p></div>
		<div class="slide"><p><a href="https://www.ruby-lang.org/en/">Ruby</a></p></div>
		<div class="slide"><p>(Optional) <a href="http://www.vmware.com/products/fusion/overview.html">VMWare fusion</a> or <a href="http://www.vmware.com/products/player/overview.html">VMWare player</a></p></div>
		
	</div>	

	<div class="slide" style="margin-left:11%">
		<h2>First step: Cloning the repo</h2>
		<div class="slide">
			<pre class="shell">
git clone https://github.com/Altoros/cf-vagrant-installer.git
cd cf-vagrant-installer
			</pre>
		</div>		
		<div class="slide">Initialize the submodules</div>
		<div class="slide">
			<pre class="shell">
rake host:bootstrap
			</pre>
		</div>		
	</div>

	<div class="slide" style="margin-left:11%">
		<h2>Second step: Provisioning the machine</h2>
		<div class="slide">Make sure we have already installed the Berkshelf and Omnibus plugins</div>
			<pre class="shell">
vagrant plugin install vagrant-berkshelf
vagrant plugin install vagrant-omnibus
			</pre>
		<div class="slide">We are using the default provider VirtualBox</div>
		<div class="slide">
			<pre class="shell">
vagrant up
			</pre>
		</div>			
	</div>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Third step: Testing our environment</h2>
		<div class="slide">Make sure we have already installed the CF command line client
			<pre class="shell">
 gem install cf
			</pre>
		</div>
		<div class="slide">Push a sample application (from our cloned repo)
			<pre class="shell">
cd test/fixtures/apps/sinatra
cf push
			</pre>
		</div>
	</div>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Development tools we are using</h2>
		<div class="slide">
			<h3>Play framework</h3>
		</div>
		<ul>
			<div class="slide"><li><p>Scala powered. Leverage as much as possible to the compiler type checker</p></li></div>
			<div class="slide"><li><p>Reactive model: based evented IO</p></li></div>
			<div class="slide"><li><p>Stateless, easy to scale</p></li></div>
			<div class="slide"><li><p>Scala and Java APIs</p></li></div>
		</ul>
		<div class="slide">
			<h3>PostgreSQL database</h3>
		</div>
		<ul>
			<div class="slide"><li><p>One of the most popular Open Source RDMBS</p></li></div>
		</ul>
		<div class="slide">
			<h3>MongoDB</h3>
		</div>
		<ul>
			<div class="slide"><li><p>NoSQL storage</p></li></div>
		</ul>
		<div class="slide">
			<h3>RabbitMQ</h3>
		</div>
		<ul>
			<div class="slide"><li><p>Message queue system</p></li></div>
			<div class="slide"><li><p>AMQP</p></li></div>
		</ul>
	</div>
</section>

<section class="slide">
	<h1>Creating and deploying our first Play application</h1>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>First step: Creating and testing our first application</h2>
		<div class="slide">
			<h3>Create a simple play application</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
play new exercice-one
			</pre>
		</div>
		<div class="slide">
			<h3>Start the app</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
play run
			</pre>
		</div>
		<div class="slide">
 			<h3>Hit your <a href="http://localhost:9000">local browser</a> </h3>
		</div>
		<div class="slide">
			<h3>Create a small change in the Application.scala file</h3>
		</div>
		<div class="slide">			
			<pre class="scala">
package controllers

import play.api.mvc.{Action, Controller}

object Application extends Controller {
  def index = Action {
    Ok(views.html.index.render("Hello Play Framework. This is the first app we are going to deploy into CF"))
  }
}	 
			</pre>
		</div>
		<div class="slide">
 			<h3>Hit your <a href="http://localhost:9000">local browser</a> again</h3>
		</div>		
	</div>
</section>


<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Second step: Deploying our application</h2>
		<div class="slide">
			<h3>Build a distributable of our application</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
play dist
			</pre>
		</div>
		<div class="slide">
			<h3>This will generate a zip file as shown in the below figure:</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
dist/exercice-one-1.0-SNAPSHOT.zip
			</pre>
		</div>
		<div class="slide">
			<h3>Start the previous artifact into our local infrastructure</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
./activator run
			</pre>
		</div>
	</div>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Third step: Test everything is fine</h2>
		<div class="slide">
			<h3>Hit <a href="http://exercice-one.192.168.12.34.xip.io/"> your new deployed app</a> at the browser</h3>
		</div>
		<h2>Modify the contents of your app. For example, the file:</h2>
		<div class="slide">			
			<pre class="shell">
app/controllers/Application.scala
			</pre>
		</div>
		<div class="slide">
			<h2>Repackage and re-push our app</h2>
		</div>
		<div class="slide">			
			<pre class="scala">
play dist
cf push --path dist/exercice-one-1.0-SNAPSHOT.zip
			</pre>
		</div>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Exercice. Play with the command line tool (I)</h2>
		<div class="slide">
			<h3>List available targets</h3>
		<div class="slide">			
			<pre class="scala">
cf targets
			</pre>
		</div>
			<h3>Set the target cloud</h3>
		<div class="slide">			
			<pre class="scala">
cf target target-url
			</pre>
		</div>
			<h3>Login into the selected target</h3>
		<div class="slide">			
			<pre class="scala">
cf login email-address
			</pre>
		</div>
			<h3>Logout from the selected target</h3>
		<div class="slide">			
			<pre class="scala">
cf logout
			</pre>
		</div>
			<h3>Change your target</h3>
		<div class="slide">			
			<pre class="scala">
cf target -s target-name
			</pre>
		</div>
	</div>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Exercice. Play with the command line tool (II)</h2>
		<div class="slide">
			<h3>List all the applications</h3>
		<div class="slide">			
			<pre class="scala">
cf apps
			</pre>
		</div>
			<h3>Show the info of an application</h3>
		<div class="slide">			
			<pre class="scala">
cf app exercice-one
			</pre>
		</div>
			<h3>Stop an application</h3>
		<div class="slide">			
			<pre class="scala">
cf stop exercice-one
			</pre>
		</div>
			<h3>Restart an application</h3>
		<div class="slide">			
			<pre class="scala">
cf restart exercice-one
			</pre>
		</div>
			<h3>Application's logs</h3>
		<div class="slide">			
			<pre class="scala">
cf logs exercice-one
			</pre>
		</div>
			<h3>Services (We will go deeper later on)</h3>
		<div class="slide">			
			<pre class="scala">
cf services
cf service service-name
			</pre>
		</div>
		</div>
	</div>
</section>

<section class="slide">
	<h1>
		A more complex application
		<div style="font-size: 70%">Creating an User management application</div>
	</h1>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>A simple User management application</h2>
		<div class="slide">
			<h3>What can we do?</h3>
		</div>
		<div class="slide"><p>Create users</p></div>
		<div class="slide"><p>List all the users</p></div>
	</div>

	<div class="slide" style="margin-left:11%">
		<h2>First step: configure our routes and actions</h2>
		<div class="slide">
			<h3>Routes</h3>
		</div>
		<div class="slide">			
			<pre class="scala">
# Home page
GET     /                           controllers.Application.index()
POST    /person                     controllers.Application.addPerson()
GET     /persons                    controllers.Application.getPersons

# Map static resources from the /public folder to the /assets URL path
GET     /assets/*file               controllers.Assets.at(path="/public", file)
			</pre>
		</div>	
	</div>

		<div class="slide" style="margin-left:11%">
		<div class="slide">
			<h3>Declare our actions in the Application.java file</h3>
		</div>
		<div class="slide">			
			<pre class="scala">
package controllers;

public class Application extends Controller {

    public static Result index() {
        // TODO
    }

    public static Result addPerson() {
    	// TODO
    }

    public static Result getPersons() {
    	// TODO
    }
}
			</pre>
		</div>
	</div>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Second step: prepare our model</h2>
		<div class="slide">
			<h3>Modeling the User entity</h3>
		</div>
		<div class="slide">			
			<pre class="scala">
package models;

import play.db.ebean.Model;
import javax.persistence.Entity;
import javax.persistence.Id;

@Entity
public class Person extends Model {

	@Id
	public String id;

	public String name;
}
			</pre>
		</div>	
	</div>
	<div class="slide" style="margin-left:11%">
		<h3>Preparing the template</h3>
		<div class="slide">			
			<pre class="html" >
@(title: String)(content: Html)

<!DOCTYPE html>

<html>
    <head>
        <title>@title</title>
        <link rel="shortcut icon" type="image/png" href="@routes.Assets.at("images/favicon.png")">
        <script src="@routes.Assets.at("javascripts/jquery-1.11.1.min.js")" type="text/javascript"></script>
    </head>
    <body>
        @content
    </body>
</html>

			</pre>
		</div>
	</div>	
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Third step: Rendering the first page</h2>
		<div class="slide">
			<h3>Creating a form to create a user and rendering the page</h3>
		</div>
		<div class="slide">			
			<pre class="scala">
@()

@main("Welcome to Play") {
	<script type='text/javascript' src='@routes.Assets.at("javascripts/index.js")'></script>

	<ul id="persons"></ul>

	<form method="POST" action="@routes.Application.addPerson()">
		<input type="text" name="name"/>
		<button>Add Person</button>
	</form>
}			</pre>
		</div>		
	</div>
	<div class="slide" style="margin-left:11%">
			<h2>Fourth step: Rendering the first page</h2>
			<div class="slide">
				<h3>Dealing with the form submission</h3>
			</div>
			<div class="slide">			
				<pre class="java">
  Person person = Form.form(Person.class).bindFromRequest().get();
  person.save();
  return redirect(routes.Application.index());
				</pre>
			</div>
		</div>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Fifth step: Connecting to the database</h2>
		<div class="slide">
			<h3>Application.conf: In memory database</h3>
		</div>
		<div class="slide">			
			<pre class="scala">
db.default.driver=org.h2.Driver
db.default.url="jdbc:h2:mem:play"
			</pre>
		</div>		
	</div>
	<div class="slide" style="margin-left:11%">
			<h3>Declaring the database schema</h3>
			
			<div class="slide">			
				<pre class="sql">
create table person (
  id                        varchar(255) not null,
  name                      varchar(255),
  constraint pk_person primary key (id))
;

create sequence person_seq;




# --- !Downs

SET REFERENTIAL_INTEGRITY FALSE;

drop table if exists person;

SET REFERENTIAL_INTEGRITY TRUE;

drop sequence if exists person_seq;
				</pre>
			</div>		
			<div class="slide">
				<h3>Reload/start your app and apply the evolutions</h3>
			</div>
		</div>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Sixth step: Writing the queries</h2>
		<div class="slide">
			<h3>Querying all the users</h3>
			
			<div class="slide">			
				<pre class="java">
List<Person> persons = new Model.Finder(String.class, Person.class).all();
return ok(toJson(persons));
				</pre>
			</div>		
			<div class="slide">
				<h3>Creating a new user</h3>
				<div class="slide">
					<pre class="java">
Person person = Form.form(Person.class).bindFromRequest().get();
person.save();
return redirect(routes.Application.index());
					</pre>
				</div>
			</div>

			<div class="slide">
				<h3>Deleting an existing user</h3>
				<div class="slide">
					<pre class="scala">
// Exercice: write the method to delete an existing user
					</pre>
				</div>
			</div>
		</div>
	</div>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Seventh step: Deploying into our local cloud</h2>
		<div class="slide">
			<h3>Create the artifact of our application</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
play clean dist
			</pre>
		</div>
		<div class="slide">
			<h3>Deploy the previous artifact into our local cloud</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
cf push --path=dist/todo-list-1.0-SNAPSHOT.zip
			</pre>
		</div>
		<div class="slide">
			<h3>Configure the deployment ....</h3>
		</div>
		<div class="slide">
			<h3>No services avilables at our local cloud :(</h3>
		</div>
		<div class="slide">
			<h3>Installing the services at our local cloud is out of our scope</h3>
			<div clas="slide">
				Want to focus on development and deployment of applications
			</div>
		</div>
		<div class="slide">
			<h3><a href="https://github.com/nttlabs/nise_bosh"> Here</a> you can find an overview of how you can achieve it</h3>
		</div>
	</div>
</section>

<section class="slide">
	<h1>Targeting our cloud provider</h1>
</section>

<section class="slide" style="margin-left:11%">
	<h2>Targeting CloudFoundry.com</h2>
	<div class="slide">
		<h3>Create a trial account in <a href="https://cloudfoundry.com">Cloud Foundry</a></h3>
	</div>

	<div class="slide">
		<h2>Target our cloud provider</a></h3>
	</div>

	<div class="slide">			
		<pre class="shell">
cf target api.run.pivotal.io
		</pre>
	</div>	

	<div class="slide">			
		<pre class="shell">
# will ask for your credentials

cf login
		</pre>
	</div>	

	<div class="slide">
		<h2>Check our current available targets</a></h3>
	</div>		

	<div class="slide">
		<pre class="shell">
cf targets
		</pre>
	</div>

	<div class="slide">
		<h2>You should see an output similar to the following</h3>
	</div>		

	<div class="slide">
		<pre class="shell">
http://api.192.168.12.34.xip.io:8181
https://api.run.pivotal.io
		</pre>
	</div>

	<div class="slide">
		<h2>At this point all our deployments will be done against CloudFoundry.com</h3>
	</div>		
</section>

<section class="slide">
	<h1>A bunch of concepts before deploying our app</h1>
</section>

<section class="slide" style="margin-left:11%">
	<div class="slide">
		<h2>Cloud foundry services</h2>
	</div>

	<div class="slide">
		<ul>
			<h3>Addons that can be provisioned alongside your application</h3>
			<h3>Database, messaging systems, etc<h3>
			<h3>You can manage them through the <code>cf service(s)</code> commands</h3>
			<h3>Bind them to your app in a diverse variety of ways (we will see later)</h3>
		</ul>
	</div>
	
	<div class="slide">
		<h2>Available services</h2>
	</div>

	<div class="slide">
		<h3>Depend on the cloud provider</h3>
	</div>

	<div class="slide">
		<h3>We are using Pivotal's offer and with our trial account we have available:</h3>
			<div class="slide">
				<ul>
					<li>Blazemeter</li>
					<li>Cleardb</li>
					<li>Cloudamqp</li>
					<li>Elephantsql</li>
					<li>Loadimpact</li>
					<li>Mongolab</li>
					<li>Newrelic</li>
					<li>Rediscloud</li>
					<li>Sendgrid</li>
					<li>Treasuredata</li>
				</ul>
			</div>
	</div>
</section>

<section class="slide">
	<h1>Deploying (again) our User Management application</h1>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
<!--
		<h2>Some restrictions due or trial account</h2>


		<div class="slide">
			<h3>Limit the number of connections because the PostgreSQL service restrictions</h3>
		</div>

		<div class="slide">
			<h3>Edit your <code>conf/application.conf</code> file</h3>
		</div>
		<div class="slide">
			<pre class="shell">				
db.default.partitionCount=1
db.default.maxConnectionsPerPartition=4
db.default.minConnectionsPerPartition=1
db.default.acquireIncrement=1
db.default.acquireRetryAttempts=1
db.default.acquireRetryDelay=5 seconds
			</pre>
		</div>
-->
		<div class="slide">
			<h2>Package and deploy</h2>
		</div>
		<div class="slide">
			<h3>Build the distributable of our application</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
play clean dist
			</pre>
		</div>
		<div class="slide">
			<h3>Deploy the artifact</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
cf push --path=target/universal/play-java-intro-1.0-SNAPSHOT.zip
			</pre>
		</div>
		<div class="slide">
			<h3>Configure the deployment ....</h3>
			<ul>
				<li>Name of your app</li>
				<li>Number of instances</li>
				<li>Domain and subdomain</li>
				<li>Services we want to bind</li>
			</ul>
		</div>		
	</div>
</section>


<section class="slide">
	<h1>
		Monitoring our application
	</h1>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Let¬¥s add monitoring support to our application</h2>		
	</div>

	<div class="slide" style="margin-left:11%">
		<h3>Create a new instance of the New Relic service</h3>		
	</div>

	<div class="slide" style="margin-left:11%">			
		<pre class="shell">
cf create-service (and follow the interactive console questions)
		</pre>
	</div>

	<div class="slide" style="margin-left:11%">
		<h3>Check our service instance has been created (note the new one has not bounded app)</h3>		
	</div>

	<div class="slide" style="margin-left:11%">			
		<pre class="shell">
cf services

elephantsql-d3a24               elephantsql   elephantsql   n/a       turtle     todo-list
newrelic-todo-list-monitoring   newrelic      newrelic      n/a       standard   none
		</pre>
	</div>

	<div class="slide" style="margin-left:11%">
		<h3>Bind our new created service to our application</h3>		
	</div>

	<div class="slide" style="margin-left:11%">			
		<pre class="shell">
cf bind-service newrelic-todo-list-monitoring todo-list
		</pre>
	</div>

	<div class="slide" style="margin-left:11%">
		<h3>We need to restart our application</h3>		
	</div>

	<div class="slide" style="margin-left:11%">			
		<pre class="shell">
cf restart todo-list
		</pre>
	</div>

	<div class="slide" style="margin-left:11%">
		<h3>Our <a href="https://console.run.pivotal.io"> Cloud Foundry console</a> has a link to our new monitoring service dashboard</h3>		
	</div>
</section>

<section class="slide">
	<h1>
		Doing some load testing
	</h1>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Let¬¥s generate some load to our application</h2>		
	</div>

	<div class="slide" style="margin-left:11%">
		<h3>Create a new instance of the New Relic service</h3>		
	</div>

	<div class="slide" style="margin-left:11%">			
		<pre class="shell">
cf create-service (and follow the interactive console questions)
		</pre>
	</div>

	<div class="slide" style="margin-left:11%">
		<h3>Check our service instance has been created (note the new one has not bounded app)</h3>		
	</div>

	<div class="slide" style="margin-left:11%">			
		<pre class="shell">
cf services

elephantsql-d3a24               elephantsql   elephantsql   n/a       turtle      todo-list
newrelic-todo-list-monitoring   newrelic      newrelic      n/a       standard    todo-list
jmeter-service                  blazemeter    blazemeter    n/a       free-tier   none
		</pre>
	</div>

	<div class="slide" style="margin-left:11%">
		<h3>Bind our new created service to our application</h3>		
	</div>

	<div class="slide" style="margin-left:11%">			
		<pre class="shell">
cf bind-service jmeter-service todo-list
		</pre>
	</div>

	<div class="slide" style="margin-left:11%">
		<h3>Our <a href="https://console.run.pivotal.io"> Cloud Foundry console</a> has a link to our new monitoring service dashboard</h3>		
	</div>
</section>


<section class="slide">
	<h1>Caching</h1>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Increasing response times: caching</h2>		
	</div>

	<div class="slide" style="margin-left:11%">
		<h3>Configuring the cache</h3>		
	</div>

	<div class="slide" style="margin-left:11%">			
		<pre class="scala">
libraryDependencies ++= Seq(
	cache,
	javaJdbc,
	javaEbean
)  
		</pre>
	</div>

	<div class="slide" style="margin-left:11%">
		<h3>Retrieving all the users</h3>		
	</div>

	<div class="slide" style="margin-left:11%">			
		<pre class="java">
// Example on how to cache all the users
		</pre>
	</div>

	<div class="slide" style="margin-left:11%">
		<h3>Creating users</h3>		
	</div>

	<div class="slide" style="margin-left:11%">			
		<pre class="java">
// Example on how to cache a single user and invalidate cache
		</pre>
	</div>

	<div class="slide" style="margin-left:11%">
		<h3>Deleting an user</h3>		
	</div>

	<div class="slide" style="margin-left:11%">			
		<pre class="java">
// Example on how to remove an element from the cache
		</pre>
	</div>
</section>

<section class="slide">
	<h1>Sending email</h1>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Sending emails</h2>		
	</div>

	<div class="slide" style="margin-left:11%">
		<h3>Configuring the plugin</h3>		
	</div>

	<div class="slide" style="margin-left:11%">			
		<pre class="scala">
libraryDependencies ++= Seq(
  "com.typesafe.play.plugins" %% "play-plugins-mailer" % "2.3.1",
  ...
)     
		</pre>
	</div>

	<div class="slide" style="margin-left:11%">			
		<pre class="scala">
conf/play.plugins 1500:com.typesafe.plugin.CommonsMailerPlugin

		</pre>
	</div>

	<div class="slide" style="margin-left:11%">
		<h3>Send an email</h3>		
		<pre class="java">
	private static void sendMail(Person person) {
		MailerAPI mail = play.Play.application().plugin(MailerPlugin.class).email();
		mail.setSubject("mailer");
		mail.setRecipient("Miguel √Ångel Pastor Olivar <miguelinlas3@gmail.com>","miguelinlas3@gmail.com");
		mail.setFrom("Miguel √Ångel Pastor Olivar <noreply@email.com>");
		mail.send( "Welcome to the system " + person.name );
	}
		</pre>
	</div>

	<div class="slide" style="margin-left:11%">
		<h3>Local configuration</h3>		
	</div>

	<div class="slide" style="margin-left:11%">			
		<pre class="properties">
conf/application.conf: smtp.mock=true
		</pre>
	</div>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Deploying into production</h2>		
	</div>

	<div class="slide" style="margin-left:11%">
		<h3>Repackage our application</h3>		
	</div>

	<div class="slide" style="margin-left:11%">			
		<pre class="shell">
./activator clean dist
		</pre>
	</div>

	<div class="slide" style="margin-left:11%">
		<h3>Push to our provider</h3>		
	</div>

	<div class="slide" style="margin-left:11%">			
		<pre class="scala">
cf push --path target/universal/play-java-intro-1.0-SNAPSHOT.zip
		</pre>
	</div>

	<div class="slide" style="margin-left:11%">
		<h3>Bind SendGrid</h3>		
	</div>

<div class="slide" style="margin-left:11%">			
		<pre class="warn">
Is it possible? Sadly, autoconfiguration doesn't work with all the services!
		</pre>
	</div>

	<div class="slide" style="margin-left:11%">
		<h3>What do we do?</h3>		
	</div>
</section>

<section class="slide">
	<h1>Some more commands and concepts</h1>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Opening a console</h2>
		<h3>Opens a console connected to your application</h3>
	</div>


	<div class="slide" style="margin-left:11%">			
		<pre class="shell">
cf console app-name
		</pre>
	</div>

	<div class="slide" style="margin-left:11%">
			<h2>Domains, Subdomains, and Routes</h2>
		</div>
		<div class="slide" style="margin-left:11%">			
			<pre class="shell">
cf domains
cf routes
			</pre>
		</div>
	<div class="slide" style="margin-left:11%">
		<h2>Spaces</h2>
		<h3>Scopes where we can manage apps, users</h3>
	</div>
	<div class="slide" style="margin-left:11%">			
		<pre class="shell">
cf spaces
		</pre>
	</div>
	<div class="slide" style="margin-left:11%">
		<h2>Exercice</h2>
	</div>
	<div class="slide" style="margin-left:11%">
		<h3>Create 2 spaces: development and production</h3>
	</div>
	<div class="slide" style="margin-left:11%">
		<h3>Create 2 users and asign one of them to development and the other one to production</h3>
	</div>
	<div class="slide" style="margin-left:11%">
		<h3>Try all the combinations</h3>
	</div>
</section>

<section class="slide">
	<h1>Deploying an existing application</h1>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Components of the application</h2>
	</div>

	<div class="slide" style="margin-left:11%">
		<h3>Written in Java</h3>
	</div>

	<div class="slide" style="margin-left:11%">
		<h3>Pluggable storage: in memory, sql, document oriented, redis</h3>
	</div>

	<div class="slide" style="margin-left:11%">
		<h3>Spring framework based. Used a different framework on purpose</h3>
	</div>

	<div class="slide" style="margin-left:11%">
		<h3>Different build system: Gradle instead of Play</h3>
	</div>

	<div class="slide" style="margin-left:11%">
		<h3>Legacy app: we have not written it ...</h3>
	</div>

	<div class="slide" style="margin-left:11%">
		<h3>But we are in charge of deployments and manteinance</h3>
	</div>

	<div class="slide" style="margin-left:11%">
		<h3>Along this example we are not focusing on the source code. Want to make emphasis in the deployment side</h3>
	</div>

	<div class="slide" style="margin-left:11%">
		<h2>Start the app in our local environment</h2>
		<pre class="shell">
./gradlew tomcatRun -Dspring.profiles.active=<profile>
		</pre>
	</div>
	<div class="slide" style="margin-left:11%">
		<h3>Supported databases</h3>
		<pre class="shell">
in-memory (no external database required)
mysql
postgres
mongodb
redis
		</pre>
	</div>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Running locally</h2>
	</div>

	<div class="slide" style="margin-left:11%">
		<h2>Install Redis</h2>
		<pre class="shell">
wget http://download.redis.io/releases/redis-2.8.17.tar.gz
tar xzf redis-2.8.17.tar.gz
cd redis-2.8.17
make
		</pre>
	</div>

	<div class="slide" style="margin-left:11%">
		<h2>Start Redis server</h2>
		<pre class="shell">
src/redis-server
		</pre>
	</div>

	<div class="slide" style="margin-left:11%">
		<h2>Interact with the Redis server</h2>
		<pre class="shell">
src/redis-cli
		</pre>
	</div>

	<div class="slide" style="margin-left:11%">
		<h2>Start our application</h2>
		<pre class="shell">
./gradlew tomcatRun -Dspring.profiles.active=redis
		</pre>
	</div>
</section>

<section class="slide">
	<h1>Moving our app into the cloud</h1>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Assembly the application</h2>
		<pre class="shell">
./gradlew assemble
		</pre>
	</div>
	<div class="slide" style="margin-left:11%">
		<h2>Exercice one</h2>
		<pre class="shell">
Deploy the application into CloudFoundry.com (use the in-memory database)
		</pre>
	</div>
	<div class="slide" style="margin-left:11%">
		<h2>Exercice two</h2>
		<pre class="shell">
Deploy the application into CloudFoundr.com using a Redis database
		</pre>
	</div>
	<div class="slide" style="margin-left:11%">
		<h2>Exercice three</h2>
		<pre class="shell">
Deploy the application into CloudFoundry.com using a MongoDB database
		</pre>
	</div>

</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>(Bonus) Exercice One: Binding services without auto-reconfiguration</h2>
	</div>
	<div class="slide" style="margin-left:11%">
		<h2>(Bonus) Exercice Two: Writing a custom buildpack</h2>
	</div>	
</section>

<section class="slide">
	<h1>
		Moving to a different provider
	</h1>
</section>

<section class="slide">
	<h1>
		A gentle introduction to Git
	</h1>
</section>

<section class="slide">
	<h1>
		Provisioning our app at a different provider
		<div style="font-size: 70%">Deploying our app to the Heroku PaaS</div>		
	</h1>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Setting up the environment</h2>
		<div class="slide">
			<h3>Create an account in <a href="http://heroku.com">Heroku</a></h3>
		</div>
		<div class="slide">
			<h3>Create an account in <a href="http://github.com">Github</a></h3>
		</div>			
		<div class="slide">
			<h3>Download the <a href="https://toolbelt.heroku.com/">Heroku Toolbelt</a></h3>
		</div>			
	</div>
	<div class="slide" style="margin-left:11%">
		<h2>Deploying our application</h2>
		<div class="slide">
			<h3>Create a new Github repo</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
<a href="https://help.github.com/articles/creating-a-new-repository">Create a new repository in Github</a>
			</pre>
		</div>
		<div class="slide">
			<h3>Clone the repo in our local machine and set the initial description</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
git clone git@github.com:migue/todo-list.git
cd todo-list
touch README.md
vi README.md
git add README.md
git commit --message="Simple todo list application"
git push origin master
			</pre>
		</div>			
		<div class="slide">
			<h3>Copy the contents of the application to this repo</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
cp -R ../../todo-list/* .
			</pre>
		</div>				
	</div>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Setting up the environment</h2>
		<div class="slide">
			<h3>Typical gitignore</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
touch .gitignore
vi .gitignore
# Paste this content
logs
project/project
project/target
target
tmp
			</pre>
		</div>
		<div class="slide">
			<h3>Configure the Heroku tooling</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
heroku login
			</pre>
		</div>
		<div class="slide">
			<h3>Create our Heroku application</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
heroku create
			</pre>
		</div>		
		<div class="slide">
			<h3>Deploy our application to Heroku</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
heroku keys:add ~/.ssh/id_rsa.pub
git push heroku master
			</pre>
		</div>	
		<div class="slide">
			<h3>Check our app is running</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
heroku ps
			</pre>
		</div>				
	</div>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Setting up the environment</h2>
		<div class="slide">
			<h3>Configure a PostgreSQL database: add dependency in the Build.scala file</h3>
		</div>
		<div class="slide">			
			<pre class="scala">
    val appDependencies = Seq(
      // Add your project dependencies here,
      "postgresql" % "postgresql" % "9.1-901-1.jdbc4"
    )
			</pre>
		</div>
		<div class="slide">
			<h3>Create Heroku config file</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
touch Procfile

# Paste this content

web: target/universal/stage/bin/play-java-intro -Dhttp.port=$PORT -DapplyEvolutions.default=true -Ddb.default.driver=org.postgresql.Driver -Ddb.default.url=${DATABASE_URL}
			</pre>
		</div>
		<div class="slide">
			<h3>Visit our application</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
heroku open
			</pre>
		</div>	
		<div class="slide">
			<h3>Take a look to the available commands</h3>
		</div>		
		<div class="slide">			
			<pre class="shell">
heroku
			</pre>
		</div>				
	</div>
</section>

<section class="slide">
	<h1>Working with addons</h1>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Database</h2>
		<div class="slide">
			<h3>By default, we already get the Postgre SQL addon</h3>
		</div>

		<div class="slide">
			<h3>Create Heroku config file</h3>
		</div>
	</div>

	<div class="slide" style="margin-left:11%">
		<h2>Send mail: using Send Grid</h2>
		<div class="slide">
			<h3>Configure the addon: Your account has to be verified to add addons to your apps</h3>
		</div>

		<div class="slide">
			<h3>Add the sendgrid addon with the start plan to our app</h3>
		</div>

		<div class="slide">			
			<pre class="shell">
heroku addons:add sendgrid:starter
			</pre>
		</div>

		<div class="slide">
			<h3>Configure the Procfile</h3>
		</div>

		<div class="slide">			
			<pre class="shell">
-Dsmtp.host=smtp.sendgrid.net -Dsmtp.port=587 -Dsmtp.ssl=yes -Dsmtp.user=$SENDGRID_USERNAME -Dsmtp.password=$SENDGRID_PASSWORD
			</pre>
		</div>
	</div>
</section>


<section class="slide" style="margin-left:11%">
	<h2>References</h2>
	<div class="slide"><p><a href="https://cloudfoundry.org">CloudFoundry.org</a></p></div>
	<div class="slide"><p><a href="https://openshift.redhat.com">OpenShift</a></p></div>
	<div class="slide"><p><a href="https://heroku.com">Heroku</a></p></div>
	<div class="slide"><p><a href="https://aws.amazon.com">Amazon AWS</a></p></div>
	<div class="slide"><p><a href="https://playframework.org">Play Framework</a></p></div>	
</section>


<!-- End slides. -->


<!-- Begin extension snippets. Add or remove as needed. -->

<!-- deck.navigation snippet -->
<a href="#" class="deck-prev-link" title="Previous">&#8592;</a>
<a href="#" class="deck-next-link" title="Next">&#8594;</a>

<!-- deck.status snippet -->
<p class="deck-status">
	<span class="deck-status-current"></span>
	/
	<span class="deck-status-total"></span>
</p>

<!-- deck.goto snippet
<form action="." method="get" class="goto-form">
	<label for="goto-slide">Go to slide:</label>
	<input type="text" name="slidenum" id="goto-slide" list="goto-datalist">
	<datalist id="goto-datalist"></datalist>
	<input type="submit" value="Go">
</form>
 -->

<!-- deck.hash snippet -->
<a href="." title="Permalink to this slide" class="deck-permalink">#</a>
</body>
</html>
